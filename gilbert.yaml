version: "1.0"
vars:
  appVersion: 1.0.0
  buildDir: '{{PROJECT}}/build'
  libDir: '{{buildDir}}/lib'
tasks:
  build:
  - if: 'file {{buildDir}}'
    description: Clean build directory
    plugin: shell
    params:
      command: 'rm -rf {{buildDir}} && mkdir {{buildDir}}'
  - description: Build server
    plugin: build
    params:
      source: './server'
      outputPath: '{{buildDir}}/server'
  - description: Copy config file
    plugin: shell
    params:
      command: 'cp ./server/config.json {{buildDir}}/config.json'
  - description: Copy assets
    plugin: shell
    params:
      command: 'cp -rf ./server/public {{buildDir}}/public'
  - description: Build reddit plugin
    plugin: build
    params:
      source: './sources/reddit'
      outputPath: '{{libDir}}/reddit.so'
      buildMode: plugin

  start:
    - if: 'file {{buildDir}}'
      plugin: shell
      params:
        command: '{{buildDir}}/server'
        workDir: '{{buildDir}}'
  clean:
  - if: file ./vendor
    description: Remove vendor files
    plugin: shell
    params:
      command: rm -rf ./vendor
